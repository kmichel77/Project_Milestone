---
title: "Project Milestone 3"
output: html_notebook
---

Authors: Katherine Nazarian, Kimberly Michel

```{r}
library(readr)
library(tidyverse)
library(dplyr)
library(lubridate)
library(zoo)

CA_flu <- read_csv("CA_flu.csv")
View(CA_flu)
LACounty_flu <- read_csv("LACounty_flu.csv")
View(LACounty_flu)
ca_vax <- read_csv("ca_vax.csv")
View(ca_vax)

```

## Subset rows or columns, as needed
rename 
```{r}
#LACounty_flu <- LACounty_flu %>% 
  #add_column(county = "LA County")

LACounty_1 <- LACounty_flu %>% 
  rename("current_infected" = infected_current) %>%
  rename("new_recovered" = recovered_new) %>% 
  rename("new_infected" = dx_new) %>% 
  rename("cumulative_infected" = infected_cum) %>% 
  rename("cumulative_recovered" = recovered_cum) %>% 
  rename("new_severe" = severe_new) %>% 
  rename("cumulative_severe" = severe_cum) %>% 
  select(-race_eth, -dt_report) %>% 
   mutate(county = word(county , 1  , -2)) %>% 
  mutate(
    quarter = case_when(
      date >= "2022-09-24" & date <= "2022-11-30" ~ 'Q1', 
      date >= "2022-12-01" & date <= "2023-02-28" ~ 'Q2', 
      date >= "2023-03-01" & date <= "2023-05-31" ~ 'Q3', 
      date >= "2023-06-01" ~ 'Q4'))


#LA_County_2 <- split(LACounty_1, cut(as.Date(LACounty_1$date), "quarter"))

CA_flu1 <- CA_flu %>% 
  rename("susceptible" = count_susceptible) %>% 
  rename("new_infected" = new_infections) %>% 
  rename("age_category" = age_cat, "date" = dt_diagnosis) %>% 
  select(-time_int, -race_ethnicity, -report_date, -pop, -new_unrecovered, -cumulative_unrecovered) %>%
  mutate(county = word(county , 1  , -2)) %>%
  mutate(
    quarter = case_when(
      date >= "2022-09-24" & date <= "2022-11-30" ~ 'Q1', 
      date >= "2022-12-01" & date <= "2023-02-28" ~ 'Q2', 
      date >= "2023-03-01" & date <= "2023-05-31" ~ 'Q3', 
      date >= "2023-06-01" ~ 'Q4'))

ca_vax1 <- ca_vax %>% 
  rename("county" = county_name, "susceptible" = est_population, "sex" = demographic_value) %>%
  select(-county_type, -suppress_data, - demographic_category) %>% 
  na.omit()
  

#can get rid of county_type in ca_vax (only 1) 
#can get rid of dt_report in LACounty_flu (only 1)

```

## Create new variables needed for analysis (minimum 2)

New variables should be created based on existing columns; for example Calculating a rate, Combining character strings, Aggregation

```{r}
#for ca_vax rate we can calculate vax rates using cum_fully_vax/est_population, but we would have to remove the NA values 

#for CA_flu we can calculate rate of infections/populations 


```

## Clean variables needed for analysis (minimum 2)

Examples Recode invalid values, Handle missing data, Recode categories

```{r}
#recode/remove NA values 
```

## Data re-structured as needed

(aggregated/summarized and/or pivoted)

```{r}

CA_flu_merge <- merge(x = CA_flu1, y = LACounty_1, by = c("county", "age_category", "quarter", "sex", "new_infected", "new_recovered", "susceptible", "current_infected", "cumulative_infected", "cumulative_recovered", "new_severe", "cumulative_severe"), all = TRUE)

CA_flu_merge_demo <- CA_flu_merge %>% 
  group_by(county, age_category, quarter) %>% 
  summarize(susceptible = sum(susceptible),
            new_infected = sum(new_infected), 
            current_infected = sum(current_infected), 
            new_severe = sum(new_severe), 
            cumulative_severe = sum(cumulative_severe))

CA_flu_merge_age <- CA_flu_merge %>% 
  group_by(age_category) %>% 
  summarize(susceptible = sum(susceptible),
            new_infected = sum(new_infected), 
            current_infected = sum(current_infected), 
            new_severe = sum(new_severe), 
            cumulative_severe = sum(cumulative_severe))

ca_vax_county <- ca_vax1 %>% 
  group_by(county) %>% 
  summarize(susceptible = sum(susceptible), 
            cum_fully_vax = sum(cum_fully_vax), 
            total_partial_vax = sum(total_partial_vax),
            cum_atleast_one_dose = sum(cum_atleast_one_dose),
            cum_unvax = sum(cum_unvax))

CA_flu_vax <- merge(x = CA_flu_merge_county, y = ca_vax_county, by = "county", all = TRUE)
```


```

## Data dictionary based on clean dataset (minimum 4 data elements), including:

Variable name, Data type, Description

```{r}

```

## One or more tables with descriptive statistics for 4 data elements

```{r}
#we'll make a ggplot at some point 
```

## Html output that is professionally prepared for presentation

Only the necessary information is outputted (you should suppress, for example, entire data frame outputs) Use of headers and sub headers to create an organized document

```{r}

```

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```{r}

```
Flu morbidity datasets (from CA and LA County)
  Recode column names, values, or formats that are in discordant (dates, etc)DONE 
  Combine morbidity datasets into a single dataset DONE
  Select demographic and geographic strata (s) of interest DONE
  Aggregate the data into a new dataframe to  include only one row per strata of     interest DONE
Vaccination dataset 
  Recode values to be consistent with morbidity datasets so they can be joined
  Select vaccination time frame that fits best with morbidity data and subset        appropriately
  Select demographic strata(s) of interest
  Create a vaccination rate metric and summarize to include only one row per strata   of interest